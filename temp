SELECT
  fullVisitorId,
  visitStartTime,
  max(p.productPrice) over(
    partition by fullVisitorId,visitStartTime order by visitStartTime
  )
  FROM
  `bigquery-public-data.google_analytics_sample.ga_sessions_20170801`,
  UNNEST(hits) AS h,
  UNNEST(h.product) AS p
limit 100
