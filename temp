


---

ðŸ“Š Real Business Case Where Subquery Is Better:

Goal: For each session, check if its pageviews > average pageviews across all sessions.

This scalar subquery is perfect here because it returns a single value that you compare inline â€” a CTE would make this more verbose.

SELECT
  fullVisitorId,
  visitStartTime,
  totals.pageviews,
  (
    SELECT AVG(totals.pageviews)
    FROM `bigquery-public-data.google_analytics_sample.ga_sessions_20170801`
    WHERE totals.pageviews IS NOT NULL
  ) AS avg_pageviews
FROM
  `bigquery-public-data.google_analytics_sample.ga_sessions_20170801`
WHERE
  totals.pageviews IS NOT NULL
LIMIT 100;


---

Shall we now try this small one first, and then move to correlated subquery, which is even more interesting and harder to replace with a CTE?

